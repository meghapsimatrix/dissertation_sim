# Simulation for My Dissertation

My dissertation examines cluster wild bootstrapping for handling dependence in meta-analysis

## Data Generation

The data generation method for this dissertation will follow that of Tipton and Pustejovsky (2015). The design focuses on correlated standardized mean differences (SMDs) for each study. Tipton and Pustejovsky (2015) examined designs resembling intervention studies with multiple continuous measures outcome variables.  Each analysis will be comprised of $m$ studies. A given study $j$ will contain $k_j$ effect sizes. 

### Standardized Mean Differences

Let $\mathbf{\bar{y}}_{Tj}$ and $\mathbf{\bar{y}}_{Cj}$ be the $k_j \times 1$ vectors of sample means for the treatment and control groups, respectively. Let $\mat{S}_j$ be the $k_j \times k_j$ sample covariance matrix of the outcomes, pooled across the treatment and control groups. Assuming multivariate normality:
\begin{equation}
\label{eq:dg1}
\mat{\bar{y}}_{Cj} \sim N\left(\mat{0}, \frac{2}{N_j} \boldsymbol\Psi_j\right), \qquad \mathbf{\bar{y}}_{Tj} \sim N\left(\bs\delta_j, \frac{2}{N_j} \boldsymbol\Psi_j\right),
\end{equation}
and,
\begin{equation}
\label{eq:dg2}
\left(\mat{\bar{y}}_{Tj} - \mat{\bar{y}}_{Cj}\right) \sim N\left(\boldsymbol\delta_j, \frac{4}{N_j} \bs\Psi_j\right).
\end{equation}
The pooled sample covariance matrix follows a multiple of a Wishart distribution with $N_j - 2$ degrees of freedom and scale matrix $\Psi_j$:
\begin{equation}
\label{eq:dg3}
(N_j - 2) \mat{S}_j \sim Wishart\left(N_j - 2, \mat{\Psi}_j \right)
\end{equation}
The denominators of SMD estimates can be generated by simulating a single Wishart matrix, extracting the diagonal elements and dividing by $N_j - 2$, and then taking the square root. 

\subsection{Covariates}

To examine the Type 1 error rates, we will simulate SMDs that are entirely unrelated to the covariates. To examine power, \textcite{tipton_small-sample_2015} generated five covariates, two binary and three continuous (the exact covariates are available in the online supplement). The first binary covariate, $X1$, is a study level covariate with large imbalance, equaling 1 in 15 percent of the studies. The second binary covariate, $X2$, a within-study covariate, is equal to 1 in 10 percent of the effect sizes overall and 0 to 20 percent  of effect sizes within a study. $X3$ is a normally distributed study level covariate, $X4$ is a normally distributed continuous covariate that varies within study, and $X5$ is a continuous, highly skewed effect-size level covariate. \textcite{tipton_small-sample_2015} noted that these types of variables are common in applied meta-analyses, with the large imbalances and skewness representing worst cases. The generated data contain 200 rows, representing the design matrix for 200 effect sizes, with 10 rows per study, totaling 20 studies. Following the procedures of \textcite{tipton_small-sample_2015}, in conditions where there will be more than 20 studies, the rows of the design matrix will be repeated. For conditions when the number of effect sizes is less than 10, the first $k_j$ rows from the design matrix for each study will be selected. 

\subsection{Meta-Analytic Data}

To generate the SMDs based on distribution of summary statistics, the number of effect size per study, the sample size per group, $\mat{\Psi}_j$, and the true effect size parameters need to be generated. For this simulation, the sample size will be assumed to be equal for treatment and control groups. 

The number of effect size per study will be generated as follows:
\begin{equation}
\label{eq:dg5}
k_j \sim 2 + Poisson(3)
\end{equation}
The sample size per group per study will be generated as follows:
\begin{equation}
\label{eq:dg6}
N_j \sim 20 + 2 \times Poisson(10)
\end{equation}
And, to generate $\mat{\Psi_j}$, $r_j$, the correlation between effect sizes per study, assuming that the correlation between pairs of effect sizes within a study, will be generated as follows:
\begin{equation}
\label{eq:dg7}
r_j \sim Beta\left(\rho \nu, (1 - \rho)\nu\right)
\end{equation}
where $\rho$ and $\nu$ controls the variability of $r_j$ across studies as $\Var(r_j) = \rho (1 - \rho) / (1 + \nu)$. Thus, smaller $\nu$ values correspond to more variable correlations. To generate $\mat{\Psi}_j$, in this simulation, the covariances in the matrix are populated with $r_j$ assuming the correlations between pairs of effect sizes within a study are equal. The variances are populated with 1's.

Below, let $\delta_{ij}$ denote the true SMD $i$ for study $j$, $\mat{x}_{ij}$ denote a $1 \times p$ vector of covariates for SMD $i$ in study $j$, $\bs{\beta}$ denote a $p \times 1$ vector of meta-regression coefficients, $v_j$ denote the between study sampling error term with mean of 0 and variance of $\tau^2$ and $u_{ij}$ denote the error term associated with the true effect size parameter for each study with mean of 0 and within-study variance of effect sizes of $\omega^2$. The true effect size parameters will be generated as follows:
\begin{equation}
\label{eq:truedelta}
\delta_{ij} = \mat{x}_{ij} \bs\beta + v_j + u_{ij}, \quad \text{where}\quad v_j \sim N(0, \tau^2), \quad u_{ij} \sim N(0, \omega^2)
\end{equation}
Here, $\mat{x}_{ij}$ will be generated as described in the Covariates section above. With the true SMD, number of effect size per study, sample size per group, and the $\mat{\Psi}_j$, a meta-analytic data will be created with SMDs and associated variances, and corresponding covariate values for $k_j$ effect sizes for each of the specified number of studies. 
